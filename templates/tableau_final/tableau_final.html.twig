{% extends 'base.html.twig' %}

{% block autres_head %}
{% endblock %}

{% block body %}
    {% set nbMatchsPrincipale = (principale|length) / 2 %}
    {% set nbJoueursPrincipale = principale|length %}
    <table class="final">
        <thead>
        <tr>
            <th colspan="{{ nbIterationsPrincipale }}">PRINCIPALE</th>
        </tr>
        <tr>
            {% for i in 1..nbIterationsPrincipale %}
                {% if i !=  nbIterationsPrincipale %}
                    <th>
                        1/{{ 2 ** (nbIterationsPrincipale - i) }}
                    </th>
                {% else %}
                    <th>
                        Finale
                    </th>
                {% endif %}
            {% endfor %}
        </tr>
        </thead>
        {# Il faut autant de ligne que de joueurs au départ #}
        {% for i in 0..nbMatchsPrincipale-1 %}
            <tr class="ligne{{ i }}0">
                <td class="cell0">
                    {{ principale[0+i] }}
                    {% if principale[0+i].id != -1 %}
                        <button class="btn-sm btn-primary pass"
                                onClick="qualif({{ i }}+'0' + ',' + 0 + ', {{ principale[0+i].nom }}')">></button>
                    {% endif %}
                </td>
                {% for j in 0..nbIterationsPrincipale-2 %}
                    <td class="cell{{ j+1 }}"> </td>
                {% endfor %}
            </tr>
            <tr class="ligne{{ i }}1">
                <td class="cell0">
                    {{ principale[nbJoueursPrincipale-1-i] }}
                    {% if principale[nbJoueursPrincipale-1-i].id != -1 %}
                        <button class="btn-sm btn-primary pass"
                                onClick="qualif({{ i }}+'1' + ',' + 0 + ',{{ principale[nbJoueursPrincipale-1-i].nom }}')">></button>
                    {% endif %}
                </td>
                {% for k in 0..nbIterationsPrincipale-2 %}
                    <td class="cell{{ k+1 }}"> </td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <hr>

    <table class="final">
        <thead>
        <tr>
            <th colspan="{{ nbIterationsConsolante }}">CONSOLANTE</th>
        </tr>
        </thead>
    </table>

    <script>
        function qualif(infos){
            /* Le joueur corerspond à 0 ou 1 pour savoir lequel est passé*/
            var numMatch = infos.substr(0,1);
            var joueur = infos.substr(1,1);
            var numCellule = infos.substr(3,1);
            var numSuivant = parseInt(numCellule)+1;
            var nomJoueur = infos.substr(5).trim();

            var ligneAdversaire;
            var ligneQualif;

            if(numMatch % 2 === 0) {
                if (parseInt(joueur) === 0) {
                    ligneAdversaire = '.ligne' + numMatch + '1';
                    ligneQualif = '.ligne' + parseInt(numMatch) / 2 + '0';
                } else {
                    ligneAdversaire = '.ligne' + numMatch + '0';
                    ligneQualif = '.ligne' + (parseInt(numMatch)) / 2 + '0';
                }
            }else{
                if (parseInt(joueur) === 0) {
                    ligneAdversaire = '.ligne' + numMatch + '1';
                    ligneQualif = '.ligne' + (parseInt(numMatch)-1)/ 2 + '1';
                } else {
                    ligneAdversaire = '.ligne' + numMatch + '0';
                    ligneQualif = '.ligne' + (parseInt(numMatch)-1) / 2 + '1';
                }
            }



            var celluleAdversaire = ligneAdversaire + " > .cell" + numCellule;
            var boutonAdversaire = ligneAdversaire + " > .cell" + numCellule + " > button";
            var boutonQualif = '.ligne' + numMatch + joueur +  " > .cell" + numCellule + " > button";

            /* On désactive les boutons */
            $(boutonAdversaire).hide();
            $(boutonQualif).hide();

            var celluleSuivante = ligneQualif + " > .cell" + numSuivant;

            /*On crée le bouton suivant*/
            /*Le numéro de la ligne sera le numéro actuel / 2 si c'est paire et le num -1 / 2 si impair*/
            var button1 = document.createElement("button");
            if(parseInt(numMatch) % 2 === 0) {
                button1.setAttribute("class", "btn-sm btn-primary pass");
                button1.setAttribute("onClick", "qualif('"+parseInt(numMatch)/2+"0,"+numSuivant+","+nomJoueur+"')");
                button1.innerHTML = ">";
            }
            else{
                button1.setAttribute("class", "btn-sm btn-primary pass");
                button1.setAttribute("onClick", "qualif('"+(parseInt(numMatch)-1)/2 +"1,"+numSuivant+","+nomJoueur+"')");
                button1.innerHTML = ">";
            }

            var span=document.createElement("SPAN");
            span.innerHTML=nomJoueur;
            $(celluleSuivante).append(span);
            $(celluleSuivante).append(button1);
            $(celluleAdversaire).css("text-decoration", "line-through").css("color", "red");
        }
    </script>

{% endblock %}


{% block title %}

{% endblock %}

